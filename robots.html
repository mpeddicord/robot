<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js canvas - camera - orthographic</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <style>
      body {
        font-family: Monospace;
        background-color: #f0f0f0;
        margin: 0px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <script src="three.min.js"></script>
    <!--Use this one to debug three.js 
    <script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
    -->

	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-2.0.2.min.js"></script>  
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="stats.min.js"></script>

    <script src="Math.js"></script>
    
    <script src="DynamicObjectBase.js"></script>
    <script src="Misc.js"></script>
    <script src="Time.js"></script>
    <script src="Robot.js"></script>
    <script src="Block.js"></script>
    <script src="World.js"></script>
    
    <style>
  		#draggable, #draggable2, #draggable3 { width: 100px; height: 100px; padding: 0.5em; float: left; margin: 0 10px 10px 0; }
  	</style>
 	 <script>
  		$(function() {
    		$( "#draggable" ).draggable({ grid: [ 50, 20 ] });
    		//$( "#draggable2" ).draggable({ scroll: true, scrollSensitivity: 100 });
    		//$( "#draggable3" ).draggable({ scroll: true, scrollSpeed: 100 });
  		});
  	</script>

	<!--
  	<div id="draggable" class="ui-widget-content">
  		<p>Scroll set to true, default settings</p>
	</div>
	-->

    <script>
      $(document).ready(function(){
        var container, stats;
        var camera, projector, renderer;
        var gridWorld;
        var screenSafeArea = 0.80;
        var zoom = 1.3;
        
        var containerLeft, containerTop;
        var containerWidth, containerHeight;
        
        window.onZoom = function(slider) {
          zoom = slider.value / 10.0;
          onWindowResize();
        }
        
        window.resetSlider = function(slider){
        	console.log("Hello");  
        	slider.value = 500;
        }

        init();
        animate();
        
        function onDocumentMouseDown( event ) {
          var cx = (event.clientX-containerLeft) / containerWidth; 
          var cy = (event.clientY-containerTop) / containerHeight; 
          
          gridWorld.handleClicks( cx, cy, camera, projector ); //This is the new interface in picking.
        }

        function init() {
          container = document.createElement( 'div' );
          document.body.appendChild( container );
                
          var info = document.createElement( 'div' );
          info.style.position = 'absolute';
          info.style.top = '50px';
          info.style.width = '100%';
          info.style.textAlign = 'left';
          info.innerHTML = 'Time Mult: <span id="timeMult">1x</span><br />Needle: <span id="needle">1x</span><br />' + 
                          '<span id="console"></span>';
          container.appendChild( info );
          
          /* //This is in HTML now
          var sliderContainer = document.createElement( 'div' );
          sliderContainer.style.position = 'absolute';
          sliderContainer.style.bottom = '20px';
          sliderContainer.style.width = '1000';
          sliderContainer.innerHTML = '<input id="defaultSlider" type="range" min="0" max="500" />';
          //document.body.appendChild( sliderContainer );
          */

          camera = new THREE.OrthographicCamera( 
            window.innerWidth / -zoom, 
            window.innerWidth / zoom, 
            window.innerHeight / zoom, 
            window.innerHeight / -zoom, 
            1, 
            5000 
          );
            
          camera.position.x = 1000;
          camera.position.y = 1000;
          camera.position.z = 1000;
          camera.lookAt(new THREE.Vector3(0,0,0));
          
          projector = new THREE.Projector(); 
          
          container.addEventListener( 'mousedown', onDocumentMouseDown, false );
          
          // Grid        
          var size = 550, step = 50;
          var gridgeometry = new THREE.Geometry();
          var gridOffset = -25;
          for ( var i = - size; i <= size; i += step ) {
            gridgeometry.vertices.push( new THREE.Vector3( -size-gridOffset, gridOffset, i-gridOffset ) );
            gridgeometry.vertices.push( new THREE.Vector3(   size-gridOffset, gridOffset, i-gridOffset ) );

            gridgeometry.vertices.push( new THREE.Vector3( i-gridOffset, gridOffset, -size-gridOffset ) );
            gridgeometry.vertices.push( new THREE.Vector3( i-gridOffset, gridOffset,   size-gridOffset ) );
          }

          var gridmaterial = new THREE.LineBasicMaterial( { color: 0x000000, opacity: 0.2 } );

          var line = new THREE.Line( gridgeometry, gridmaterial );
          line.type = THREE.LinePieces;
          scene.add( line );

          // Cubes
          gridWorld = new World(scene);

          // Lights
          var ambientLight = new THREE.AmbientLight( 0.75 * 0x10 );
          scene.add( ambientLight );

          var directionalLight = new THREE.DirectionalLight( 0xffffff );
          directionalLight.position.x = 0.25;
          directionalLight.position.y = 0.5;
          directionalLight.position.z = 0.25;

          directionalLight.position.normalize();
          scene.add( directionalLight );

          var directionalLight = new THREE.DirectionalLight( 0xffffff );

          directionalLight.position.x = -1;
          directionalLight.position.y = -0.5;
          directionalLight.position.z = -0.25;

          directionalLight.position.normalize();
          scene.add( directionalLight );

          // Renderer
          renderer = new THREE.WebGLRenderer();
          //renderer = new THREE.CanvasRenderer();

          calculateContainerSize();

          renderer.setSize( containerWidth, containerHeight );
          renderer.domElement.style.borderStyle = 'solid';
          renderer.domElement.style.borderWidth = '1px';
          renderer.domElement.style.borderColor = '#000000';
                    
          positionRenderer();
          
          container.appendChild( renderer.domElement );

          stats = new Stats();
          stats.domElement.style.position = 'absolute';
          stats.domElement.style.top = '0px';
          container.appendChild( stats.domElement );
          
          $( "#programs" ).tabs();
          var z= $( "#zoom" )[0];
          window.onZoom(z);

          window.addEventListener( 'resize', onWindowResize, false );
        }
                
        function positionRenderer() {
          renderer.domElement.style.position = 'absolute';
          containerLeft = Math.floor((window.innerWidth - containerWidth) * 0.5);
          containerTop = containerLeft;
          renderer.domElement.style.left = containerLeft.toString() + 'px';
          renderer.domElement.style.top = containerTop.toString() + 'px';
        }

        function onWindowResize() {
          calculateContainerSize();
          
          camera.left = containerWidth / -zoom;
          camera.right = -camera.left;
          camera.top = containerHeight / zoom;
          camera.bottom = -camera.top;
          camera.updateProjectionMatrix();
          
          renderer.setSize( containerWidth, containerHeight );
          positionRenderer();
        }
        
        function calculateContainerSize() {
          var bottomUiTop = $( "#programs" ).position().top;
          containerWidth = screenSafeArea * window.innerWidth;
          containerHeight = screenSafeArea * bottomUiTop;
        }

        //
        var lastTime = Date.now();
        function animate() {
          var thisTime = Date.now();
          var delta = (thisTime - lastTime) / 1000.0;
          lastTime = thisTime;

          requestAnimationFrame( animate );

          render();
          stats.update();
          gridWorld.update(delta);
        }

        function render() {
          var timer = Date.now() * 0.0001 + gridWorld.rotMod;

          var middleOfGrid = (gridWorld.worldSize * gridWorld.worldStep) / 2;

          //camera.position.x = Math.cos( timer ) * 200 + middleOfGrid;
          //camera.position.z = Math.sin( timer ) * 200 + middleOfGrid;
          //camera.lookAt( new THREE.Vector3(middleOfGrid, 100, middleOfGrid) );

          renderer.render( scene, camera );
        }
      });
    </script>
    
    
    
      <div style="position:absolute; bottom:20px;">
      	<h4>Controls</h4>
      	Time Slider<br />
      	<input id="timeScaler" type="range" min="0" max="1000" style="width:500px" onmouseup="resetSlider(this);"/> Pause<input type="checkbox" id="pause" name="pause"><br />
      	Zoom<br />
      	<input id="zoom" type="range" min="12" max="25" style="width:500px" onchange="onZoom(this);" />
      </div>
      <div id="programs" style="position:absolute; bottom:5px; right:5px">
        <ul>
          <li><a href="#robo-1">Robot 1</a></li>
          <li><a href="#robo-2">Robot 2</a></li>
          <li><a href="#robo-3">Robot 3</a></li>
        </ul>
        <div id="robo-1">
          <p>Robot 1 Program</p>
        </div>
        <div id="robo-2">
          <p>Robot 2 Program</p>
        </div>
        <div id="robo-3">
          <p>Robot 3 Program</p>
        </div>
      </div>
    </body>
</html>
